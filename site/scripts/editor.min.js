"use strict";function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _wrapRegExp(e,t){_wrapRegExp=function(e,t){return new n(e,void 0,t)};var i=_wrapNativeSuper(RegExp),o=RegExp.prototype,a=new WeakMap;function n(e,t,n){var r=i.call(this,e,t);return a.set(r,n||a.get(e)),r}function c(n,e){var r=a.get(e);return Object.keys(r).reduce(function(e,t){return e[t]=n[r[t]],e},Object.create(null))}return _inherits(n,i),n.prototype.exec=function(e){var t=o.exec.call(this,e);return t&&(t.groups=c(t,this)),t},n.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=a.get(this);return o[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,function(e,t){return"$"+n[t]}))}if("function"!=typeof t)return o[Symbol.replace].call(this,e,t);var r=this;return o[Symbol.replace].call(this,e,function(){var e=[];return e.push.apply(e,arguments),"object"!==_typeof(e[e.length-1])&&e.push(c(e,r)),t.apply(this,e)})},_wrapRegExp.apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Resizable=function(){function i(e,t){var n,r=this;_classCallCheck(this,i),_defineProperty(this,"root",null),_defineProperty(this,"rootStyle",null),_defineProperty(this,"panes",[]),_defineProperty(this,"resizers",[]),_defineProperty(this,"fracs",[]),_defineProperty(this,"pos",[]),this.root=e,this.rootStyle=window.getComputedStyle(e),this.panes=e.querySelectorAll("[data-resizable] > *"),this.resizers=e.querySelectorAll("[data-resizable] [data-resizer]"),t?this.fracs=t:(n=1/this.panes.length,this.panes.forEach(function(e){return r.fracs.push(n)})),this.initPos(),this.applyFracs(),this.resizers.forEach(function(e,t){return r.addDragLogic(t,e)})}return _createClass(i,[{key:"setFracs",value:function(e){this.fracs=e,this.initPos(),this.applyFracs()}},{key:"getTop",value:function(){return this.root.getBoundingClientRect().top+ +this.rootStyle.borderTopWidth.replace("px","")}},{key:"getHeight",value:function(){return this.root.clientHeight}},{key:"getResizerHeight",value:function(){return this.resizers[0].offsetHeight}}]),_createClass(i,[{key:"addDragLogic",value:function(r,i){var o=this;0!==r&&i.addEventListener("mousedown",function(e){e.preventDefault();function t(e){var t=(e.pageY-n-o.getTop()-o.getResizerHeight()*r)/(o.getHeight()-o.getResizerHeight()*o.panes.length);t<0&&(t=0),1<t&&(t=1),o.updatePos(r,t),o.updateFracs(),o.applyFracs()}var n=e.clientY-i.getBoundingClientRect().top;window.addEventListener("mousemove",t),window.addEventListener("mouseup",function(){return window.removeEventListener("mousemove",t)})})}},{key:"initPos",value:function(){this.pos=[];for(var e=0,t=0;t<this.fracs.length;t++)this.pos.push(e),e+=this.fracs[t]}},{key:"updatePos",value:function(e,t){if(t<this.pos[e])for(var n=e-1;0<=n;n--){if(this.pos[n]<t)break;this.pos[n]=t}else for(var r=e+1;r<this.pos.length;r++){if(t<this.pos[r])break;this.pos[r]=t}this.pos[e]=t}},{key:"updateFracs",value:function(){this.fracs=[];for(var e=0,t=1;e<this.pos.length;e++,t++){var n=this.pos[e],r=t===this.pos.length?1:this.pos[t];this.fracs.push(r-n)}}},{key:"applyFracs",value:function(){var i=this;this.panes.forEach(function(e,t){var n,r=i.fracs[t];0===r?e.classList.add("_collapsed"):e.classList.remove("_collapsed"),e.setAttribute("style",(n=r,"\nheight: calc((100% - ".concat(i.panes.length*i.getResizerHeight(),"px) * ").concat(n," + ").concat(i.getResizerHeight(),"px);\n            ")))})}}]),i}();document.addEventListener("DOMContentLoaded",function(){var r=document.querySelector("body > .editor"),i=document.querySelector("#resizerMain"),o=document.querySelector("body > .view > .resizerOverlay");i.addEventListener("mousedown",function(e){e.preventDefault(),o.setAttribute("style","display: block;");var n=e.clientX-i.getBoundingClientRect().left;function t(e){var t;t=e.pageX-n,r.setAttribute("style","flex: 0; flex-basis: ".concat(t,"px;"))}window.addEventListener("mousemove",t),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",t),o.removeAttribute("style")})})}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".editors[data-resizable]");new Resizable(e,[.05,.2,.15,.6])});var iframe,IFrame=function(){function n(e){_classCallCheck(this,n),_defineProperty(this,"loaded",!1),_defineProperty(this,"iframe",null),_defineProperty(this,"contentWindow",null),_defineProperty(this,"queueArr",[]);var t=this;document.querySelector("iframe").addEventListener("load",function(){t.loaded=!0,t.contentWindow=this.contentWindow,t.iframe=this.contentWindow.document,e&&e(),t.queueArr.forEach(function(e){return e()})})}return _createClass(n,[{key:"queue",value:function(e){this.loaded?e():this.queueArr.push(e)}},{key:"setContent",value:function(e,t){this.getBlock(e).querySelector(".content").innerHTML=t,this.contentWindow.enableComponents()}},{key:"getBlock",value:function(e){return this.iframe.querySelector("#".concat(e))}},{key:"toggleBlock",value:function(e){this.iframe.querySelector("#".concat(e)).classList.toggle("_hidden")}}]),n}();_defineProperty(IFrame,"BLOCKS",{TASK:"task",HINT:"hint",EXPLANATION:"explanation"}),document.addEventListener("DOMContentLoaded",function(){iframe=new IFrame(function(){iframe.setContent(IFrame.BLOCKS.HINT,"<b>Я самый умный в мире!</b>")})});var Translator=function(){function e(){_classCallCheck(this,e),_defineProperty(this,"md",null),this.md=window.markdownit({html:!0,subscript:!1,superscript:!1})}return _createClass(e,[{key:"renderStripMeta",value:function(e){return e.replace(/^---$([\s\S]*?)^---$/gm,function(e,t,n){return 0===n?"":e})}},{key:"renderMath",value:function(t){function n(e){var t=!(0<arguments.length&&void 0!==e)||e,n={output:"html"};return n.displayMode=t,n.strict="ignore",n.macros=r,n}var e={display:[/^\$\$([\s\S]*?)\$\$$/gm,/^\\\[([\s\S]*?)\\\]$/gm],inline:[/(?<!\$)\$(?!\$)(.*?)\$/g,/\\\((.*?)\\\)/g]},r={"\\tg":"\\mathop{\\rm tg}\\nolimits","\\ctg":"\\mathop{\\rm ctg}\\nolimits","\\sgn":"\\mathop{\\rm sgn}\\nolimits","\\ceil":"\\left\\lceil #1 \\right\\rceil","\\floor":"\\left\\lfloor #1 \\right\\rfloor","\\limn":"\\lim\\limits_{n\\to\\infty}","\\set":"\\left\\{#1\\right\\}"};return e.display.forEach(function(e){t=t.replace(e,function(e,t){return katex.renderToString(t,n())})}),e.inline.forEach(function(e){t=t.replace(e,function(e,t){return katex.renderToString(t,n(!1))})}),t}},{key:"renderInline",value:function(e){return e=(e=e.replace(/<p:\[(.*?)\]>/gm,function(e,t){return'<a class="niceUnderline protoLink" href="#" title="'.concat(t,'"><i class="fas fa-sitemap"></i><span>П.00</span></a>')})).replace(/<t:\[(.*?)\]>/gm,function(e,t){return'<a class="niceUnderline taskLink" href="#"><i class="fas fa-hashtag"></i><span>'.concat(t,"</span></a>")})}},{key:"renderMultiline",value:function(e){var r=this;return e=e.replace(_wrapRegExp(/^\|\|\| spoiler (.+)$([\0-\uFFFF]+?)^\|\|\|/gm,{name:1,content:2}),function(e,t,n){return'\n<div class="spoiler">\n    <div class="head" title="Раскрыть">\n        <div class="title">'.concat(t.trim(),'</div>\n        <div class="toggleButton"><i class="fas"></i></div>\n    </div>\n    <div class="contentHolder">\n        <div class="content">').concat(r.renderSimple(n),"</div>\n    </div>\n</div>\n            ")})}},{key:"renderMarkdown",value:function(e){return this.md.render(e)}},{key:"renderSimple",value:function(e){return e=this.renderMath(e),e=this.renderInline(e)}},{key:"renderAll",value:function(e){return e=this.renderStripMeta(e),e=this.renderMath(e),e=this.renderInline(e),e=this.renderMultiline(e),e=this.renderMarkdown(e)}}]),e}(),translator=new Translator,Editor=function(){function r(e,t){var n=this;_classCallCheck(this,r),_defineProperty(this,"config",{mode:"markdown",lineNumbers:!0,lineWrapping:!0,theme:"base16-dark"}),_defineProperty(this,"blockName",null),_defineProperty(this,"editor",null),_defineProperty(this,"changeTimer",null),this.blockName=e,this.editor=CodeMirror(t,_objectSpread({value:this.getInitValue()},this.config)),this.editor.on("change",function(e,t){n.onChange(t)}),iframe.queue(function(){n.doChange()}),this.setupClickFocus(t)}return _createClass(r,[{key:"getInitValue",value:function(){return null!==localStorage.getItem("content-"+this.blockName)?localStorage.getItem("content-"+this.blockName):"task"===this.blockName?"Условие задачи **точно так**, как она представлена в задачнике.":""}},{key:"setupClickFocus",value:function(e){var t=this;e.addEventListener("click",function(e){e.target===this&&(t.editor.focus(),t.editor.setCursor(t.editor.lineCount(),0))})}},{key:"onChange",value:function(){var e=this;clearTimeout(this.changeTimer),this.changeTimer=setTimeout(function(){e.save(),e.doChange()},500)}},{key:"doChange",value:function(){["taskHint","answer"].includes(this.blockName)||iframe.setContent(this.blockName,translator.renderAll(this.editor.getValue()))}},{key:"save",value:function(){localStorage.setItem("content-"+this.blockName,this.editor.getValue())}}]),r}();document.addEventListener("DOMContentLoaded",function(){var c=new Editor("task",document.querySelector("#task .content")),s=new Editor("hint",document.querySelector("#hint .content")),u=new Editor("explanation",document.querySelector("#explanation .content")),l=new Editor("taskHint",document.querySelector("#settings .miniEditor.hint .editorHolder")),f=new Editor("answer",document.querySelector("#settings .miniEditor.answer .editorHolder"));document.querySelectorAll(".actions .action.toggable").forEach(function(e){e.addEventListener("click",function(){this.classList.toggle("_active")})}),["task","hint","explanation"].forEach(function(e){document.querySelector("#".concat(e," .actions .action.visibility")).addEventListener("click",function(){iframe.toggleBlock(e)})}),document.querySelector("body > .editor > header .action.download").addEventListener("click",function(){var t=document.querySelector(".taskNum input").value.trim();0===t.length&&(t="0000");var e=document.querySelector(".solver input").value.trim();0===e.length&&(e="unknown");var n=new JSZip,r="",i=document.querySelector(".plain input").value.trim();console.log(i),0<i.length&&(r='---\n{ "plain": "'.concat(i,'" }\n---\n\n')),0<(r+=c.editor.getValue().trim()).length&&n.file("".concat(t,"/task.md"),r),0<l.editor.getValue().trim().length&&n.file("".concat(t,"/hint.md"),l.editor.getValue().trim()),0<f.editor.getValue().trim().length&&n.file("".concat(t,"/answer.md"),f.editor.getValue().trim()),0<s.editor.getValue().trim().length&&n.file("".concat(t,"/").concat(e,"/hint.md"),s.editor.getValue().trim());var o="",a=[];document.querySelectorAll(".tags .tag input:checked").forEach(function(e){a.push(e.parentElement.classList[1])}),0<a.length&&(o='---\n{ "tags": ['.concat(a.map(function(e){return'"'.concat(e,'"')}),"] }\n---\n\n")),0<(o+=u.editor.getValue().trim()).length&&n.file("".concat(t,"/").concat(e,"/explanation.md"),o),n.generateAsync({type:"blob"}).then(function(e){return saveAs(e,"".concat(t,".zip"))})})});