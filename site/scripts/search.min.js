"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var SearchState={NORMAL:"normal",NOTSOLVED:"notSolved",WTF:"wtf",SUCCESS:"success"},Search=function(){function s(e){var t=this;_classCallCheck(this,s),_defineProperty(this,"searchElem",null),_defineProperty(this,"state",SearchState.NORMAL),_defineProperty(this,"searchInput",""),_defineProperty(this,"taskNum",null),_defineProperty(this,"timers",{placeholder:null,input:null}),this.searchElem=e,this.setupSearchInput(),window.addEventListener("resize",function(){clearTimeout(t.timers.placeholder),t.timers.placeholder=setTimeout(function(){t.adjustPlaceholder()},100)}),this.adjustPlaceholder()}return _createClass(s,[{key:"adjustPlaceholder",value:function(){this.searchElem.querySelector("input").placeholder=window.innerWidth<=450?"Номер задачи (1 - 4462)":"Введите номер задачи (от 1 до 4462)"}},{key:"setupSearchInput",value:function(){var t=this;this.searchElem.querySelector("input").addEventListener("input",function(){var e=this.value.trim();e!==t.searchInput&&(t.searchInput=e,t.inputChange())})}},{key:"inputChange",value:function(){var e=this;clearTimeout(this.timers.input),this.timers.input=setTimeout(function(){e.updateState()},200)}},{key:"updateState",value:function(){var e;this.clearState(),""!==this.searchInput?/^\d+$/.test(this.searchInput)?(e=+this.searchInput,1<=(this.taskNum=e)&&e<=4462?void 0!==HASH[e]?(this.setState(SearchState.SUCCESS),this.loadTask(e)):this.setState(SearchState.NOTSOLVED):this.setState(SearchState.WTF)):this.setState(SearchState.WTF):this.setState(SearchState.NORMAL)}},{key:"setState",value:function(e){this.state=e;var t=[];this.state!==SearchState.NORMAL&&(t.push("_paneShowing"),t.push("_state--".concat(this.state))),(e=this.searchElem.classList).add.apply(e,t)}},{key:"clearState",value:function(){this.searchElem.classList="searchBar",this.searchElem.querySelector(".result > .success").classList.remove("_loaded"),this.searchElem.querySelector(".stateButton").removeAttribute("href"),this.taskNum=null}},{key:"loadTask",value:function(e){var t=this;fetch("/tasks/".concat(e,"/preview.json")).then(function(e){return e.json()}).then(function(e){t.searchElem.querySelector(".result > .success > .task.content").innerHTML=e.task,t.searchElem.querySelector(".result > .success").classList.add("_loaded"),t.setupLink()})}},{key:"setupLink",value:function(){this.searchElem.querySelector(".stateButton").href="/tasks/".concat(this.taskNum),this.searchElem.querySelector(".result > .success > .goto").href="/tasks/".concat(this.taskNum)}}]),s}();document.addEventListener("DOMContentLoaded",function(){new Search(document.querySelector(".searchBar")),document.querySelector(".searchBar > input").addEventListener("keydown",function(e){"Enter"===e.key&&void 0!==HASH[this.value.trim()]&&(window.location.href="/tasks/".concat(this.value.trim()))})});