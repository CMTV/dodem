(()=>{importScripts("/site/vendor/lzutf8/lzutf8.min.js","/site/vendor/lunr/lunr.min.js","/site/vendor/lunr/lunr-stemmer.min.js","/site/vendor/lunr/lunr-ru.min.js");var l=class{constructor(){this.ready=!1;this.fetchHash=null;this.fetchIndex=null;this.fetchBookRefs=null;this.fetchHash=this.fetchCompressed("/site/search/hash.json.lz"),this.fetchIndex=this.fetchCompressed("/site/search/index.json.lz"),this.fetchBookRefs=this.fetchCompressed("/site/search/bookRefs.json.lz")}fetchCompressed(e){return fetch(e).then(t=>t.text())}decompressJSON(e){return JSON.parse(LZUTF8.decompress(e,{inputEncoding:"BinaryString"}))}whenReady(e){if(this.ready){e();return}Promise.all([this.fetchHash,this.fetchIndex,this.fetchBookRefs]).then(t=>{this.hash=this.decompressJSON(t[0]),this.index=lunr.Index.load(this.decompressJSON(t[1])),this.bookRefs=this.decompressJSON(t[2]),this.ready=!0,this.whenReady(e)})}},u=class{constructor(e){this.bookNum=0;this.taskNum=0;this.bookHTML="";this.taskHTML="";e.forEach(t=>{let r=+t.ref;if(r<5e3)this.taskNum++,this.taskHTML+=new d(r).toHTML();else{this.bookNum++;let h=new p(n.bookRefs[r-5e3]);this.bookHTML+=new m(h).toHTML()}})}},o=class{},d=class extends o{constructor(e){super();this.taskNum=e,this.link="/tasks/"+e}toHTML(){return`<a class="taskResult" href="${this.link}" title="К задаче ${this.taskNum}">${this.taskNum}</a>`}},m=class extends o{constructor(e){super();this.link="/book/"+e.id,this.type=a.MAP[e.type],this.title=e.title}toHTML(){return`
            <a href="${this.link}" class="bookResult">
                <div class="type type--${this.type.name}">${this.type.content}</div>
                <span>${this.title}</span>
            </a>
        `}},i=class{constructor(e,t){this.name=e,this.content=t}},a=i;a.MAP={0:new i("definition","О"),1:new i("theorem","Т"),2:new i("method","М"),3:new i("other","Д")};var p=class{constructor(e){this.id=e[0],this.type=e[1],this.title=e[2]}},f=class{},k=self,n=new l;onmessage=s=>{let e=s.data;n.whenReady(()=>{let t=new f;if(t.id=e.id,e.searchQuery in n.hash)t.data=e.searchQuery;else{let r=[];e.searchQuery.split(" ").forEach(c=>{r.push(c+"^10"),r.push(c+"*")});let h=n.index.search(r.join(" "));t.data=new u(h)}k.postMessage(t)})};})();
