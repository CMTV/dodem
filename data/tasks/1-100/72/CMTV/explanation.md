Введем обозначение:

$$ x_n = \left(1 + \frac{1}{n}\right)^n $$

## Лемма

Докажем, что

$$ e > 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

В прото-задаче <p:[sequences/limits/second-wonderful]> в процессе рассуждений мы получили следующее равенство:

$$ x_n = 2 + s_2 + s_3 + \ldots + s_k + \ldots + s_n, $$

где

$$ s_k = \frac{1}{k!}\left( 1 - \frac{1}{n} \right)\left( 1-\frac{2}{n} \right)\ldots\left( 1-\frac{k-1}{n} \right) $$

Составим неравенство, убрав из $x_n$ все слагаемые после $s_k$:

$$ x_n > 2 + s_2 + s_3 + \ldots + s_k $$

Заметим, что количество слагаемых справа конечно.

Возьмем предел обеих частей по прото-задаче <p:[sequences/limits/limits-inequality]>:

$$ \limn x_n \geq \limn (2 + s_2 + \ldots + s_k) $$

$$ e \geq 2 + \limn s_2 + \ldots + \limn s_k $$

Найдем теперь предел

$$
    \limn s_k = \frac{1}{k!}\left(1-\limn\frac{1}{n}\right)\ldots\left(1-(k-1)\limn\frac{1}{n}\right) =
    \\[5px]
    = \frac{1}{k!}(1-0)(1-0)\ldots(1-0) = \frac{1}{k!}
$$

$$ \limn s_k = \frac{1}{k!} $$

Тогда

$$ e \geq 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{k!} $$

Важно отметить, что мы зафиксировали $k$. Но можно фиксировать и $k+1$, $k+2$ и так далее, отодвигая при необходимости $n$ в $x_n$.
Другими словами, для любого $n$ выполняется неравенство:

$$ e \geq 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

На самом деле, выполняется и более строгий вариант:

$$ e > 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

Действительно, справа стоит последовательность. Ее следующей член получается добавлением нового слагаемого $\frac{1}{(n+1)!}$, поэтому общая сумма только увеличится, то есть это строго возрастающая последовательность.
Если бы какой-то член этой последовательности оказался бы равен $e$, то уже со следующего члена последовательность будет уже строго больше $e$. Получили противоречие. Значит, выполняется строгое неравенство.

Итак,

$$ e > 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

## Доказательство сходимости

В прото-задачи <p:[sequences/limits/second-wonderful]> в процессе рассуждений мы получили следующее неравенство:

$$ x_n < 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

Но в лемме выше мы показали, что

$$ 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} \leq e $$

Объединяем в одно цепное неравенство:

$$ x_n < 2 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} \leq e $$

Последовательность $x_n$ слева по определению сходится к $e$. "Последовательность" из $e$ справа тоже сходится к $e$.
А значит, по теореме о двух милиционерах, "зажатая" между ними последовательность тоже сходится к $e$:

$$ \limn \left( 1 + 1 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} \right) = e  $$

$\blacksquare$

## Вывод формулы

Введем обозначение:

$$ y_n = 1 + 1 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} $$

Рассмотрим разницу:

$$ y_{n+p} - y_{n}, \quad (p>0) $$

$$
    y_{n+p} - y_n = 2 + \frac{1}{2!} + \ldots + {1}{(n+p)!} - 2 - \frac{1}{2!} - \ldots - \frac{1}{n!} =
    \\[5px]
    = \frac{1}{(n+1)!} + \frac{1}{(n+2)!} + \ldots + \frac{1}{(n+p)!}
$$

$$ y_{n+p} - y_n = \frac{1}{(n+1)!} + \ldots + \frac{1}{(n+p)!} $$

Отсюда очевидно, что $y_{n+p}-y_n > 0$.

Вынесем за скобки дробь $\frac{1}{(n+1)!}$:

$$ y_{n+p} - y_n = \frac{1}{(n+1)!}\left( 1 + \frac{1}{n+2} + \frac{1}{(n+2)(n+3)} + \ldots \right) $$

В больших скобках справа в знаменателях можно заменить все скобки $(n+i)$ на $(n+2)$:

$$ y_{n+p} - y_n \leq \frac{1}{(n+1)!}\left( 1 + \frac{1}{n+2} + \frac{1}{(n+2)^2} + \ldots \right) $$

В скобках имеем сумму $p$ членов геометрической прогрессии. Воспользуемся свойством, что если знаменатель $0 < q < 1$, то

$$ 1 + q + q^2 + \ldots + q^n < \frac{1}{1-q} \ (q < 1) $$

||| spoiler Доказательство
Пусть $0 < q < 1$. Докажем, что

$$ 1 + q + q^2 + \ldots + q^n < \frac{1}{1-q} \ (q < 1) $$

Для суммы слева воспользуемся суммой $n$ членой геометрической прогрессии:

$$ 1 + q + q^2 + \ldots + q^n = \frac{1(1 - q^n)}{1-q} $$

Получим неравенство, заменив $1-q^n$ на $1$:

$$ 1 + q + q^2 + \ldots + q^n = \frac{1-q^n}{1-q} < \frac{1}{1-q} $$

$$ 1 + q + q^2 + \ldots + q^n < \frac{1}{1-q} $$

$\blacksquare$
|||

Применяем это свойство:

$$ y_{n+p} - y_n < \frac{1}{(n+1)!}\frac{1}{1-\frac{1}{n+2}} $$

$$ y_{n+p} - y_n < \frac{1}{(n+1)!}\frac{1}{1-\frac{1}{n+2}}\frac{n+2}{n+2} $$

$$ y_{n+p} - y_n < \frac{1}{(n+1)!}\frac{n+2}{n+1} $$

$$ y_{n+p} - y_n < \frac{1}{n!}\frac{n+2}{(n+1)^2} $$

Итак, имеем следующее цепное неравенство:

$$ 0 < y_{n+p} - y_n < \frac{1}{n!}\frac{n+2}{(n+1)^2} $$

Считаем, что $n$ — фиксированное число и по прото-задаче <p:[sequences/limits/limits-inequality]> находим предел при $p\to \infty$ всех частей неравенства:

$$ 0 \leq \lim\limits_{p\to\infty} (y_{n+p}-y_n) \leq \lim\limits_{p\to\infty} \frac{1}{n!}\frac{n+2}{(n+1)^2} $$

$$ 0 \leq \underbrace{\lim\limits_{p\to\infty} (y_{n+p})}_{= e} -y_n \leq \frac{1}{n!}\frac{n+2}{(n+1)^2} $$

Здесь мы воспользовались тем, что $y_{n+p}\to e$, так как $y_{n+p}$ — подпоследовательность последовательности $y_p$ (помним, что $n$ — фиксированное число), а значит, по прото-задаче <p:[sequences/limits/limit-point]> раз $y_p\to e$, то и
любая ее подпоследовательность тоже стремится к $e$, то есть $y_{n+p}\to e$.

Итак:

$$ 0 \leq e - y_n \leq \frac{1}{n!}\frac{n+2}{(n+1)^2} $$

||| spoiler $$ \frac{n+2}{(n+1)^2} < \frac{1}{n} $$

Докажем, что

$$ \frac{n+2}{(n+1)^2} < \frac{1}{n} $$

$$ n(n+2) < (n+1)^2 $$

$$ n^2 + 2n < n^2 + 2n + 1 $$

$$ 0 < 1 $$

$\blacksquare$
|||

$$ 0 \leq e - y_n \leq \frac{1}{n!}\frac{n+2}{(n+1)^2} < \frac{1}{n!}\frac{1}{n} $$

$$ 0 \leq e - y_n < \frac{1}{n!n} $$

В лемме мы показали, что $e > y_n$, поэтому $e-y_n > 0$:

$$ 0 < e-y_n < \frac{1}{n!n} $$

$$ 0 < (e-y_n)n!n < 1 $$

Число по середине будем называть $\Theta_n$:

$$ 0 < \Theta_n = (e-y_n)n!n < 1 $$

$$ 0 < \Theta_n < 1 $$

Так как

$$ \Theta_n = (e-y_n)n!n $$

Тогда

$$ e-y_n = \frac{\Theta_n}{n!n} $$

Откуда

$$ e = 1 + 1 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{n!} + \frac{\Theta_n}{n!n} $$

$\blacksquare$

## Расчет $e$ с точностью до $10^{-5}$

Мы знаем, что $y_n\to e$. С этой позиции расчет $n$-го члена последовательности $y_n$ можно принимать за "измерение" числа $e$.

Найдем абсолютную погрешность нашего "измерения":

$$ \Delta = |y_n - e| $$

Воспользуемся свойством модуля (см. прото-задачу <p:[abs]>):

$$ \Delta = |y_n - e| = |e-y_n| $$

Но $e-y_n$, как мы уже показали выше, всегда строго больше $0$ поэтому можно убрать знак модуля:

$$ \Delta = e-y_n $$

Но по выведенной выше формуле имеем

$$ \Delta = e-y_n = \frac{\Theta_n}{n!n} $$

$$ \Delta = \frac{\Theta_n}{n!n} $$

Нам нужно рассчитать число $e$ с точностью до $10^{-5}$, это значит, что наша абсолютная погрешность должна быть не больше этого числа.

$$ \Delta = \frac{\Theta_n}{n!n} \leq 10^{-5} $$

$$ \frac{\Theta_n}{n!n} \leq 10^{-5} $$

Мы доказали, что $0 < \Theta_n < 1$, поэтому можно усилить неравенство:

$$ \frac{\Theta_n}{n!n} < \frac{1}{n!n} \leq 10^{-5} $$

$$ \frac{1}{n!n} \leq 10^{-5} $$

$$ n!n \geq 10^5 $$

Методом подбора получаем, что уже при $n = 8$

$$ 8!8 = 322 560 > 10^5 $$

Рассчитаем тогда $y_8$:

$$ y_8 = 1 + 1 + \frac{1}{2!} + \frac{1}{3!} + \ldots + \frac{1}{8!} = \frac{109601}{40320} $$

Итак, число

$$ \frac{109601}{40320} = 2.71827\ldots $$

является числом $e$ с точностью до $10^{-5}$.